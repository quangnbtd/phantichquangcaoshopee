<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopee Ads Analytics Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .upload-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .file-upload {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            background: #f8f9ff;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .file-upload:hover {
            border-color: #764ba2;
            background: #f0f2ff;
            transform: translateY(-2px);
        }
        
        .file-upload input {
            display: none;
        }
        
        .upload-icon {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .results {
            display: none;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            color: #666;
            font-size: 1.1em;
        }
        
        .charts-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        
        .table-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .data-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .data-table tr:hover {
            background: #f8f9ff;
        }
        
        .recommendations {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .recommendation-item {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: white;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Shopee Ads Analytics Dashboard</h1>
            <p>Ph√¢n t√≠ch d·ªØ li·ªáu qu·∫£ng c√°o Shopee m·ªôt c√°ch th√¥ng minh v√† tr·ª±c quan</p>
        </div>
        
        <div class="upload-section">
            <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">üìÅ</div>
                <h3>T·∫£i l√™n file CSV d·ªØ li·ªáu qu·∫£ng c√°o Shopee</h3>
                <p>Ch·ªçn file ho·∫∑c k√©o th·∫£ file v√†o ƒë√¢y</p>
                <input type="file" id="fileInput" accept=".csv" onchange="handleFileUpload(event)">
            </div>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>ƒêang ph√¢n t√≠ch d·ªØ li·ªáu...</p>
        </div>
        
        <div class="results" id="results">
            <div class="stats-grid" id="statsGrid">
                <!-- Stats s·∫Ω ƒë∆∞·ª£c t·∫°o ƒë·ªông -->
            </div>
            
            <div class="charts-section">
                <div class="chart-card">
                    <h3 class="chart-title">Top 10 T·ª´ Kh√≥a Hi·ªáu Qu·∫£ Nh·∫•t</h3>
                    <canvas id="keywordChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Ph√¢n B·ªë Chi Ph√≠ vs ROAS</h3>
                    <canvas id="costRoasChart"></canvas>
                </div>
            </div>
            
            <div class="table-section">
                <h3 class="chart-title">Chi Ti·∫øt Hi·ªáu Su·∫•t T·ª´ Kh√≥a</h3>
                <table class="data-table" id="keywordTable">
                    <thead>
                        <tr>
                            <th>T·ª´ kh√≥a</th>
                            <th>L∆∞·ª£t xem</th>
                            <th>L∆∞·ª£t click</th>
                            <th>CTR (%)</th>
                            <th>Chuy·ªÉn ƒë·ªïi</th>
                            <th>CVR (%)</th>
                            <th>Chi ph√≠</th>
                            <th>ROAS</th>
                            <th>ƒê√°nh gi√°</th>
                        </tr>
                    </thead>
                    <tbody id="keywordTableBody">
                    </tbody>
                </table>
            </div>
            
            <div class="recommendations">
                <h3 class="chart-title">üéØ G·ª£i √ù T·ªëi ∆Øu H√≥a</h3>
                <div id="recommendationsContent">
                    <!-- Recommendations s·∫Ω ƒë∆∞·ª£c t·∫°o ƒë·ªông -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let adsData = [];
        
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            document.getElementById('loading').style.display = 'block';
            
            Papa.parse(file, {
                header: true,
                encoding: 'UTF-8',
                skipEmptyLines: true,
                dynamicTyping: true,
                complete: function(results) {
                    processData(results.data);
                    document.getElementById('loading').style.display = 'none';
                },
                error: function(error) {
                    alert('L·ªói ƒë·ªçc file: ' + error.message);
                    document.getElementById('loading').style.display = 'none';
                }
            });
        }
        
        function processData(data) {
            // L·ªçc d·ªØ li·ªáu h·ª£p l·ªá
            adsData = data.filter(row => 
                row['T·ª´ kh√≥a'] && 
                row['T·ª´ kh√≥a'] !== 'Ch·ªçn Th·ªß C√¥ng' &&
                row['S·ªë l∆∞·ª£t xem'] > 0
            );
            
            generateStats();
            generateCharts();
            generateTable();
            generateRecommendations();
            
            document.getElementById('results').style.display = 'block';
        }
        
        function generateStats() {
            const totalImpressions = adsData.reduce((sum, row) => sum + (row['S·ªë l∆∞·ª£t xem'] || 0), 0);
            const totalClicks = adsData.reduce((sum, row) => sum + (row['S·ªë l∆∞·ª£t click'] || 0), 0);
            const totalConversions = adsData.reduce((sum, row) => sum + (row['L∆∞·ª£t chuy·ªÉn ƒë·ªïi'] || 0), 0);
            const totalCost = adsData.reduce((sum, row) => sum + (row['Chi ph√≠'] || 0), 0);
            const totalGMV = adsData.reduce((sum, row) => sum + (row['GMV'] || 0), 0);
            
            const avgCTR = totalImpressions > 0 ? (totalClicks / totalImpressions * 100).toFixed(2) : 0;
            const avgCVR = totalClicks > 0 ? (totalConversions / totalClicks * 100).toFixed(2) : 0;
            const totalROAS = totalCost > 0 ? (totalGMV / totalCost).toFixed(2) : 0;
            
            const stats = [
                { label: 'T·ªïng L∆∞·ª£t Xem', value: totalImpressions.toLocaleString() },
                { label: 'T·ªïng L∆∞·ª£t Click', value: totalClicks.toLocaleString() },
                { label: 'CTR Trung B√¨nh', value: avgCTR + '%' },
                { label: 'T·ªïng Chuy·ªÉn ƒê·ªïi', value: totalConversions },
                { label: 'CVR Trung B√¨nh', value: avgCVR + '%' },
                { label: 'T·ªïng Chi Ph√≠', value: (totalCost/1000).toFixed(0) + 'K VNƒê' },
                { label: 'T·ªïng Doanh Thu', value: (totalGMV/1000).toFixed(0) + 'K VNƒê' },
                { label: 'ROAS T·ªïng', value: totalROAS }
            ];
            
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = stats.map(stat => `
                <div class="stat-card">
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                </div>
            `).join('');
        }
        
        function generateCharts() {
            // Chart 1: Top t·ª´ kh√≥a hi·ªáu qu·∫£
            const topKeywords = adsData
                .filter(row => row['ROAS'] > 0)
                .sort((a, b) => b['ROAS'] - a['ROAS'])
                .slice(0, 10);
            
            const ctx1 = document.getElementById('keywordChart').getContext('2d');
            new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: topKeywords.map(row => row['T·ª´ kh√≥a'].substring(0, 20) + '...'),
                    datasets: [{
                        label: 'ROAS',
                        data: topKeywords.map(row => row['ROAS']),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
            
            // Chart 2: Chi ph√≠ vs ROAS
            const costRoasData = adsData
                .filter(row => row['Chi ph√≠'] > 0 && row['ROAS'] > 0)
                .slice(0, 20);
            
            const ctx2 = document.getElementById('costRoasChart').getContext('2d');
            new Chart(ctx2, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Chi ph√≠ vs ROAS',
                        data: costRoasData.map(row => ({
                            x: row['Chi ph√≠'],
                            y: row['ROAS']
                        })),
                        backgroundColor: 'rgba(118, 75, 162, 0.6)',
                        borderColor: 'rgba(118, 75, 162, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { 
                            title: { display: true, text: 'Chi ph√≠ (VNƒê)' }
                        },
                        y: { 
                            title: { display: true, text: 'ROAS' }
                        }
                    }
                }
            });
        }
        
        function generateTable() {
            const tableBody = document.getElementById('keywordTableBody');
            const sortedData = adsData
                .sort((a, b) => (b['ROAS'] || 0) - (a['ROAS'] || 0))
                .slice(0, 20);
            
            tableBody.innerHTML = sortedData.map(row => {
                const evaluation = getKeywordEvaluation(row);
                return `
                    <tr>
                        <td>${row['T·ª´ kh√≥a']}</td>
                        <td>${(row['S·ªë l∆∞·ª£t xem'] || 0).toLocaleString()}</td>
                        <td>${(row['S·ªë l∆∞·ª£t click'] || 0).toLocaleString()}</td>
                        <td>${(row['T·ª∑ L·ªá Click'] || '0.00%')}</td>
                        <td>${row['L∆∞·ª£t chuy·ªÉn ƒë·ªïi'] || 0}</td>
                        <td>${(row['T·ª∑ l·ªá chuy·ªÉn ƒë·ªïi'] || '0.00%')}</td>
                        <td>${((row['Chi ph√≠'] || 0)/1000).toFixed(0)}K</td>
                        <td>${(row['ROAS'] || 0).toFixed(2)}</td>
                        <td style="color: ${evaluation.color}">${evaluation.text}</td>
                    </tr>
                `;
            }).join('');
        }
        
        function getKeywordEvaluation(row) {
            const roas = row['ROAS'] || 0;
            const conversions = row['L∆∞·ª£t chuy·ªÉn ƒë·ªïi'] || 0;
            
            if (roas > 5) return { text: 'üî• Xu·∫•t s·∫Øc', color: '#28a745' };
            if (roas > 2) return { text: '‚úÖ T·ªët', color: '#17a2b8' };
            if (roas > 1) return { text: '‚öñÔ∏è Kh·∫£ thi', color: '#ffc107' };
            if (conversions > 0) return { text: '‚ö†Ô∏è C·∫ßn c·∫£i thi·ªán', color: '#fd7e14' };
            return { text: '‚ùå K√©m hi·ªáu qu·∫£', color: '#dc3545' };
        }
        
        function generateRecommendations() {
            const recommendations = [];
            
            // Ph√¢n t√≠ch t·ª´ kh√≥a hi·ªáu qu·∫£ cao
            const highPerformingKeywords = adsData.filter(row => row['ROAS'] > 3);
            if (highPerformingKeywords.length > 0) {
                recommendations.push({
                    title: 'üöÄ TƒÉng ng√¢n s√°ch cho t·ª´ kh√≥a hi·ªáu qu·∫£ cao',
                    content: `C√≥ ${highPerformingKeywords.length} t·ª´ kh√≥a c√≥ ROAS > 3. H√£y tƒÉng ng√¢n s√°ch cho c√°c t·ª´ kh√≥a: ${highPerformingKeywords.slice(0, 3).map(k => k['T·ª´ kh√≥a']).join(', ')}`
                });
            }
            
            // Ph√¢n t√≠ch t·ª´ kh√≥a k√©m hi·ªáu qu·∫£
            const poorKeywords = adsData.filter(row => (row['Chi ph√≠'] || 0) > 10000 && (row['L∆∞·ª£t chuy·ªÉn ƒë·ªïi'] || 0) === 0);
            if (poorKeywords.length > 0) {
                recommendations.push({
                    title: 'üóëÔ∏è Lo·∫°i b·ªè t·ª´ kh√≥a k√©m hi·ªáu qu·∫£',
                    content: `${poorKeywords.length} t·ª´ kh√≥a c√≥ chi ph√≠ cao nh∆∞ng kh√¥ng c√≥ chuy·ªÉn ƒë·ªïi. C√¢n nh·∫Øc t·∫°m d·ª´ng ho·∫∑c gi·∫£m gi√° th·∫ßu.`
                });
            }
            
            // Ph√¢n t√≠ch t·ª´ kh√≥a c√≥ ti·ªÅm nƒÉng
            const potentialKeywords = adsData.filter(row => 
                (row['S·ªë l∆∞·ª£t xem'] || 0) > 100 && 
                (row['T·ª∑ L·ªá Click'] || '0%').replace('%', '') > 2 && 
                (row['L∆∞·ª£t chuy·ªÉn ƒë·ªïi'] || 0) === 0
            );
            if (potentialKeywords.length > 0) {
                recommendations.push({
                    title: 'üí° T·ªëi ∆∞u t·ª´ kh√≥a c√≥ ti·ªÅm nƒÉng',
                    content: `${potentialKeywords.length} t·ª´ kh√≥a c√≥ l∆∞·ª£t xem v√† CTR t·ªët nh∆∞ng ch∆∞a c√≥ chuy·ªÉn ƒë·ªïi. H√£y t·ªëi ∆∞u trang s·∫£n ph·∫©m ho·∫∑c ƒëi·ªÅu ch·ªânh gi√° th·∫ßu.`
                });
            }
            
            // T·ªïng h·ª£p chi ph√≠
            const totalCost = adsData.reduce((sum, row) => sum + (row['Chi ph√≠'] || 0), 0);
            const totalGMV = adsData.reduce((sum, row) => sum + (row['GMV'] || 0), 0);
            const overallROAS = totalCost > 0 ? totalGMV / totalCost : 0;
            
            if (overallROAS < 2) {
                recommendations.push({
                    title: '‚ö†Ô∏è C·∫£i thi·ªán ROAS t·ªïng th·ªÉ',
                    content: `ROAS t·ªïng th·ªÉ hi·ªán t·∫°i l√† ${overallROAS.toFixed(2)}. Khuy·∫øn ngh·ªã t·∫≠p trung v√†o c√°c t·ª´ kh√≥a c√≥ ROAS > 2 v√† c·∫Øt gi·∫£m ng√¢n s√°ch cho t·ª´ kh√≥a k√©m hi·ªáu qu·∫£.`
                });
            }
            
            const recommendationsContent = document.getElementById('recommendationsContent');
            recommendationsContent.innerHTML = recommendations.map(rec => `
                <div class="recommendation-item">
                    <h4>${rec.title}</h4>
                    <p>${rec.content}</p>
                </div>
            `).join('');
        }
        
        // Drag and drop functionality
        const fileUpload = document.querySelector('.file-upload');
        
        fileUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUpload.style.backgroundColor = '#f0f2ff';
        });
        
        fileUpload.addEventListener('dragleave', (e) => {
            e.preventDefault();
            fileUpload.style.backgroundColor = '#f8f9ff';
        });
        
        fileUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUpload.style.backgroundColor = '#f8f9ff';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('fileInput').files = files;
                handleFileUpload({ target: { files: files } });
            }
        });
    </script>
</body>
</html>
